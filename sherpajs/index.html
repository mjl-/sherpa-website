<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Sherpajs - Sherpa</title>
		<link rel="stylesheet" href="../style.css" />
	</head>
	<body>
<div class="crumbs">
	<a href="../../">mjl</a> &gt;
	<a href="../">sherpa</a> &gt;
	<a class="last" href="./">sherpajs</a>
</div>

<div class="tocbar">
	<a href="../">Sherpa</a> |
	<a href="../specification/">Specification</a> |
	<a class="active" href="../sherpajs/">Sherpajs</a> |
	<a href="../implementations/">Implementations</a> |
	<a href="../why/">Why</a> |
	<a href="../faq/">FAQ</a> |
	<a href="../about/">About</a>
</div>

<h1 id="consuming-a-sherpa-api"><a href="#consuming-a-sherpa-api">Consuming a Sherpa API</a></h1>
<p>
In the introduction we showed the easiest way to get started with Sherpa API's.  Sherpa API's serve a tiny JavaScript library that exposes an API object. That object provides JavaScript functions for all API functions available.
</p>

<p>
This works well enough for small projects, especially when you have a single app that serves the HTML/JavaScript and the Sherpa API. For projects where you use an externally developed Sherpa API or want to include a Sherpa JavaScript library in a single JavaScript file for fast loading, you might not want to include such an external library.  This page describes the stand-alone <i>sherpa.js</i> library.
</p>

<h2 id="sherpajs"><a href="#sherpajs">Stand-alone sherpa.js</a></h2>
<p>
The stand-alone Sherpa library for JavaScript is part of sherpaweb. See <a href="https://bitbucket.org/mjl/sherpaweb/src/default/assets/s/js/sherpa.js?fileviewer=file-view-default">sherpa.js</a>. Sherpaweb uses it to access Sherpa API's. You can include this file in your project. Then call either <code>sherpa.init(url,&nbsp;_sherpa)</code> or <code>sherpa.load(url)</code>.  Both yield an API object on which you can call the functions exported by the API. Those function calls return promise-like objects, so-called "thenables".
</p>

<h2 id="sherpajs-init"><a href="#sherpajs-init">sherpa.init</a></h2>
<p>If the list of functions your Sherpa-API-consuming-app uses is fixed, <code>sherpa.init</code> is the easiest way to get started. The second parameter, <code>_sherpa</code> should be an object like the one returned by <i>sherpa.json</i>. However, all the otherwise required attributes are optional, except for <code>functions</code>. <code>sherpa.init</code> returns an API object ready to call functions on:</p>
<code><pre>&lt;script src="/static/js/sherpa.js"&gt;
&lt;script&gt;
var exampleapi = sherpa.init('https://sherpa.irias.nl/exampleapi/', {functions: ['requestCount']});

exampleapi.requestCount()
.then(function(result) {
	alert('Number of requests: '+result);
}, function(error) {
	alert('Error: '+JSON.stringify(error));
});
&lt;/script&gt;</pre></code>

<h2 id="sherpajs-load"><a href="#sherpajs-load">sherpa.load</a></h2>
<p>
If the list of functions is not known beforehand, you should use <code>sherpa.load</code>. It is used by sherpaweb too. <code>sherpa.load</code> first fetches <i>sherpa.json</i>, then calls <code>sherpa.init</code> with the object as second parameter. The difference is that <code>sherpa.load</code> doesn't return the API object, but a thenable that yields the API object on success. Let's look at an example.
</p>

<code><pre>&lt;script src="/static/js/sherpa.js"&gt;
&lt;script&gt;
sherpa.load('https://sherpa.irias.nl/exampleapi/')
.then(function(exampleapi) {
	exampleapi.requestCount()
	.then(function(result) {
		alert('Number of requests: '+JSON.stringify(result));
	}, function(error) {
		alert('Error: '+JSON.stringify(error));
	});

	...
});
&lt;/script&gt;</pre></code>

<h2 id="_call"><a href="#_call">_call</a></h2>
<p>
The API object provides a function named <code>_call</code>. It calls a Sherpa function by name. The first parameter is the function name. The remaining parameters are the actual parameters used in the call. An example:
</p>

<code><pre>exampleapi._call('_echo', ["test", 123])
.then(function(result) {
	alert('echo: '+JSON.stringify(result));
}, function(error) {
	alert('error: '+error.message);
})</pre></code>

<h2 id="_sherpa"><a href="#_sherpa">_sherpa</a></h2>
<p>
The API object provides an attribute <code>_sherpa</code>. It contains the API descriptor as returned by the <i>sherpa.json</i> endpoint. However, all fields except <code>functions</code> are optional. API's created by <code>sherpa.init</code> will not have fully filled <code>_sherpa</code> objects.

<h2 id="_wrapThenable"><a href="#_wrapThenable">_wrapThenable</a></h2>
<p>
Sherpa API function calls, and also <code>sherpa.load</code> return "thenables". These are objects on which you can register success and error callbacks by calling their function <code>then</code>. Modern browsers have support for full promises, but older browsers do not. Sherpa does not use full promises. However, a thenable can be turned into a promise by calling <code>new Promise(thenable)</code>.
</p>
	</body>
</html>
